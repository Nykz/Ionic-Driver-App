import{a as m,b as k}from"./chunk-RZ7UTHTO.js";import{a as y}from"./chunk-CFZVMA6D.js";import{a as O}from"./chunk-ZSWNRFCL.js";import{B as C,c as u,j as _,l as w,m as h,rc as P,sc as b}from"./chunk-HSJ3UP2Q.js";import{a as d,b as o,f as r}from"./chunk-RW4GY4BD.js";var I={amount_per_km:5,base_amount:20,base_distance:3,radius:15,restaurant_share:90,rider_share:70,tax:18};var D=(()=>{let s=class s{get settings(){return this._settings.asObservable()}constructor(e){this.api=e,this._settings=new u({})}getFareSettings(){return r(this,null,function*(){try{let e=this._settings.value;if(e!=null&&e.id)return e;let t=d({},I);return console.log(t),this._settings.next(t),t}catch(e){throw e}})}};s.\u0275fac=function(t){return new(t||s)(w(y))},s.\u0275prov=_({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();var c=[{address:{id:"1",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"1",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"1",cover:"assets/dishes/nan.jpg",desc:"Soft and buttery Naan served with delectable paneer curry.",id:"4",name:"Butter Naan with Paneer",price:200,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!0,quantity:1},{category_id:"2",cover:"assets/dishes/pasta.jpg",desc:"Indulge in the rich and creamy Creamy Alfredo Pasta, a classic Italian favorite.",id:"5",name:"Creamy Alfredo Pasta",price:250,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!1,quantity:1}],total:450,grandTotal:470,deliveryCharge:20,status:"Delivered",rating:{rate_restaurant:4,comment_restaurant:"Taste is fine, but not like usual",rate_rider:5,comment_rider:"Delivery is fast"},payment_status:!0,payment_mode:"COD",discount:0,id:"4",user_id:"1",instruction:"Less spicy",created_at:"Jul 28, 2023 2:50 PM",updated_at:"Jul 28, 2023 2:50 PM",restaurant:{id:"1",cover:"assets/restaurants/1.jpg",name:"Stayfit Kitchen",cuisines:["Indian","Italian","Mexican"],rating:5,delivery_time:25,distance:2.5,price:100,latitude:28.633255,longitude:77.219487,address:"M-Block, Connaught Place, New Delhi, India",user_id:"6",city_id:"1"},payment_id:"1",rider:new m("abc@gmail.com","9101000003","Ravi S","4","rider","active",null,"DL05DL4321",28.633255,77.219487,"active"),rider_id:"4",restaurant_share:405,restaurant_payout_status:!0,rider_share:14,rider_payout_status:!0},{address:{id:"3",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"5",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"15",cover:"assets/dishes/margherita.jpg",desc:"Classic Margherita Pizza with fresh tomatoes, mozzarella, and basil.",id:"17",name:"Margherita Pizza",price:200,rating:0,status:!0,restaurant_id:"5",variation:!1,veg:!0,quantity:1},{category_id:"15",cover:"assets/dishes/pepperoni.jpg",desc:"Savory Pepperoni Pizza topped with delicious pepperoni slices and cheese.",id:"18",name:"Pepperoni Pizza",price:250,rating:0,status:!0,restaurant_id:"5",variation:!1,veg:!1,quantity:1},{category_id:"16",cover:"assets/dishes/bbq-chicken.png",desc:"Delicious BBQ Chicken Pizza with tender chicken and tangy barbecue sauce.",id:"21",name:"BBQ Chicken Pizza",price:260,rating:0,status:!0,restaurant_id:"5",variation:!1,veg:!1,quantity:2}],total:970,grandTotal:990,deliveryCharge:20,status:"Delivered",payment_status:!0,payment_mode:"COD",discount:0,id:"3",user_id:"1",instruction:"",created_at:"Jul 27, 2023 8:53 PM",updated_at:"Jul 27, 2023 8:53 PM",restaurant:{id:"5",cover:"assets/restaurants/pizza.jpg",name:"Pizza Hub",cuisines:["Italian","Indian","Spanish"],rating:4.6,delivery_time:20,distance:1.8,price:150,latitude:28.653237,longitude:77.237436,address:"Lal Qila, Chandni Chowk, Delhi, 110006"},payment_id:"",rating:{rate_restaurant:4,comment_restaurant:"Nice food!",rate_rider:5,comment_rider:"Delivery was quick...before time."},rider:new m("xyz@gmail.com","9101000004","Xavier","5","rider","active",null,"DL05DL3322",28.633255,77.219487,"active"),rider_id:"5",restaurant_share:873,restaurant_payout_status:!0,rider_share:14,rider_payout_status:!0},{address:{id:"2",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"4",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"12",cover:"assets/dishes/chocolate_cake.png",desc:"Rich and creamy Chocolate Cake, a delightful treat for all chocolate lovers.",id:"14",name:"Chocolate Cake",price:350,rating:0,status:!0,restaurant_id:"4",variation:!1,veg:!0,quantity:1},{category_id:"12",cover:"assets/dishes/icecream_bowl.png",desc:"Assorted ice cream flavors - vanilla, chocolate, and strawberry.",id:"15",name:"Ice Cream Bowl",price:120,rating:0,status:!0,restaurant_id:"4",variation:!1,veg:!0,quantity:6}],total:1070,grandTotal:1090,deliveryCharge:20,status:"Picked",payment_status:!0,payment_mode:"Stripe",discount:0,id:"2",user_id:"1",instruction:"",created_at:"Jul 27, 2023 8:41 PM",updated_at:"Jul 27, 2023 8:41 PM",restaurant:{id:"4",cover:"assets/restaurants/spiceofindia.png",name:"Spice of India",cuisines:["Indian","Chinese"],rating:4.8,delivery_time:30,distance:3.2,price:120,latitude:28.652982,longitude:77.193031,address:"Pusa Road, New Delhi, India"},payment_id:"",rider:new m("abc@gmail.com","9101000003","Ravi S","4","rider","active",null,"DL05DL4321",28.648626,77.199239,"active"),rider_id:"4"},{address:{id:"1",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"1",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"1",cover:"assets/dishes/nan.jpg",desc:"Soft and buttery Naan served with delectable paneer curry.",id:"4",name:"Butter Naan with Paneer",price:200,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!0,quantity:1},{category_id:"2",cover:"assets/dishes/pasta.jpg",desc:"Indulge in the rich and creamy Creamy Alfredo Pasta, a classic Italian favorite.",id:"5",name:"Creamy Alfredo Pasta",price:250,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!1,quantity:1}],total:450,grandTotal:470,deliveryCharge:20,status:"Cancelled",payment_status:!0,payment_mode:"COD",discount:0,id:"1",user_id:"1",instruction:"",created_at:"Jul 27, 2023 8:09 PM",updated_at:"Jul 27, 2023 8:09 PM",restaurant:{id:"1",cover:"assets/restaurants/1.jpg",name:"Stayfit Kitchen",cuisines:["Indian","Italian","Mexican"],rating:5,delivery_time:25,distance:2.5,price:100,latitude:28.633255,longitude:77.219487,address:"M-Block, Connaught Place, New Delhi, India"},payment_id:""},{address:{id:"2",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"1",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"1",cover:"assets/dishes/nan.jpg",desc:"Soft and buttery Naan served with delectable paneer curry.",id:"4",name:"Butter Naan with Paneer",price:200,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!0,quantity:2}],total:400,grandTotal:420,deliveryCharge:20,status:"Created",payment_status:!0,payment_mode:"UPI",discount:0,id:"5",user_id:"1",instruction:"",created_at:"Jul 27, 2023 8:41 PM",updated_at:"Jul 27, 2023 8:41 PM",restaurant:{id:"1",cover:"assets/restaurants/1.jpg",name:"Stayfit Kitchen",cuisines:["Indian","Italian","Mexican"],rating:5,delivery_time:25,distance:2.5,price:100,latitude:28.633255,longitude:77.219487,address:"M-Block, Connaught Place, New Delhi, India",user_id:"6",city_id:"1"},payment_id:""},{address:{id:"1",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"1",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"1",cover:"assets/dishes/nan.jpg",desc:"Soft and buttery Naan served with delectable paneer curry.",id:"4",name:"Butter Naan with Paneer",price:200,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!0,quantity:1},{category_id:"2",cover:"assets/dishes/pasta.jpg",desc:"Indulge in the rich and creamy Creamy Alfredo Pasta, a classic Italian favorite.",id:"5",name:"Creamy Alfredo Pasta",price:250,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!1,quantity:1}],total:450,grandTotal:470,deliveryCharge:20,status:"Ongoing",payment_status:!0,payment_mode:"Card",discount:0,id:"6",user_id:"1",instruction:"Less spicy",created_at:"Jul 28, 2023 2:50 PM",updated_at:"Jul 28, 2023 2:50 PM",restaurant:{id:"1",cover:"assets/restaurants/1.jpg",name:"Stayfit Kitchen",cuisines:["Indian","Italian","Mexican"],rating:5,delivery_time:25,distance:2.5,price:100,latitude:28.633255,longitude:77.219487,address:"M-Block, Connaught Place, New Delhi, India",user_id:"6",city_id:"1"},payment_id:"",rider:new m("abc@gmail.com","9101000003","Ravi S","4","rider","active",null,"DL05DL4321",28.5500969,77.1580178,"active"),rider_id:"4"},{address:{id:"1",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"1",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"1",cover:"assets/dishes/nan.jpg",desc:"Soft and buttery Naan served with delectable paneer curry.",id:"4",name:"Butter Naan with Paneer",price:200,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!0,quantity:1},{category_id:"2",cover:"assets/dishes/pasta.jpg",desc:"Indulge in the rich and creamy Creamy Alfredo Pasta, a classic Italian favorite.",id:"5",name:"Creamy Alfredo Pasta",price:250,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!1,quantity:1}],total:450,grandTotal:470,deliveryCharge:20,status:"Accepted",payment_status:!1,payment_mode:"COD",discount:0,id:"7",user_id:"1",instruction:"Less spicy",created_at:"Jul 28, 2023 2:50 PM",updated_at:"Jul 28, 2023 2:50 PM",restaurant:{id:"1",cover:"assets/restaurants/1.jpg",name:"Stayfit Kitchen",cuisines:["Indian","Italian","Mexican"],rating:5,delivery_time:25,distance:2.5,price:100,latitude:28.633255,longitude:77.219487,address:"M-Block, Connaught Place, New Delhi, India",user_id:"6",city_id:"1"},rider_requests:["4","5"]}];var S=[{id:"1",rider_id:"4",totalOrders:1,todayOrders:0,totalEarned:14,todayEarned:0,totalShareEarned:14,amountReceived:14,amountRemaining:0}];var Z=(()=>{let s=class s{get newOrders(){return this._newOrders.asObservable()}get ongoingOrders(){return this._ongoingOrders.asObservable()}get orders(){return this._orders.asObservable()}get ordersFiltered(){return this._ordersFiltered.asObservable()}get orderReviews(){return this._orderReviews.asObservable()}constructor(){this.currency=P.CURRENCY,this.auth=h(O),this.global=h(b),this.profileService=h(k),this.settings=h(D),this.api=h(y),this._newOrders=new u([]),this._ongoingOrders=new u([]),this._orders=new u([]),this._ordersFiltered=new u([]),this._orderReviews=new u([]),this.currentOrder=C(null)}getUid(){return r(this,null,function*(){this.uid||(this.uid=yield this.auth.getId())})}getNewOrders(){return r(this,null,function*(){try{yield this.api.delayedResponse(500),yield this.getUid();let e=c.filter(a=>a.status==="Accepted"&&(a==null?void 0:a.rider_requests.includes(this.uid))),t=this._newOrders.value||[];return console.log("currentOrders",t),t=t.concat(e),this._newOrders.next(t),e}catch(e){throw e}})}getOngoingOrders(){return r(this,null,function*(){try{yield this.api.delayedResponse(500),yield this.getUid();let e=c.filter(a=>a.rider_id==this.uid&&(a.status=="Picked"||a.status=="Ongoing")),t=this._ongoingOrders.value||[];return console.log("ongoingOrders",t),t=t.concat(e),this._ongoingOrders.next(t),e}catch(e){throw e}})}getPastOrders(){return r(this,null,function*(){try{yield this.api.delayedResponse(500),yield this.getUid(),console.log(this.uid);let e=c.filter(a=>a.rider_id==this.uid&&(a.status=="Delivered"||a.status=="Cancelled"||a.status=="Rejected"));console.log("orders",e);let t=this._orders.value||[];return console.log("currentOrders",t),t=t.concat(e),this._orders.next(t),e}catch(e){throw e}})}getOrderCounts(){return r(this,null,function*(){try{yield this.api.delayedResponse(500),yield this.getUid(),console.log(this.uid);let e=S.find(t=>t.rider_id==this.uid);return console.log(e),e}catch(e){throw e}})}getPastOrdersHistory(e){return r(this,null,function*(){try{yield this.api.delayedResponse(500),yield this.getUid();let t=new Date;t.setHours(0,0,0,0);let a=c.filter(n=>{if(n.rider_id==this.uid&&(n.status=="Delivered"||n.status=="Cancelled"||n.status=="Rejected"))if(e=="pending"){if((n==null?void 0:n.rider_payout_status)==!1)return!0}else if(e=="today"){let g=new Date(n.created_at);if(g.setHours(0,0,0,0),g.getTime()===t.getTime())return!0}else return!0;return!1});console.log("orders",a);let i=this._ordersFiltered.value||[];return console.log("currentOrders",i),i=i.concat(a),this._ordersFiltered.next(i),a}catch(t){throw t}})}getOrder(e){return r(this,null,function*(){var t;try{if(yield this.api.delayedResponse(500),yield this.getUid(),((t=this.currentOrder())==null?void 0:t.id)==e)return this.currentOrder();let a=c.find(i=>i.id==e);return this.currentOrder.set(a),a}catch(a){throw a}})}changeOrderStatus(e,t){return r(this,null,function*(){var a;try{yield this.api.delayedResponse(500),yield this.getUid();let i=o(d({},e),{updated_at:new Date});e!=null&&e.cancel_reason&&(i=o(d({},i),{cancel_reason:e.cancel_reason}));let n=0,g=0,v=0;if((e==null?void 0:e.status)=="Delivered"){let p=yield this.settings.getFareSettings();v=this.global.formatNumber(p.rider_share/100*+(e==null?void 0:e.deliveryCharge));let f=v,j=+(e==null?void 0:e.total)-((a=e==null?void 0:e.coupon)!=null&&a.restaurant_id?+e.coupon.saved:0);n=this.global.formatNumber(p.restaurant_share/100*j)+ +(e==null?void 0:e.tax);let R=n;g=+(e==null?void 0:e.grandTotal)-v-n,i=o(d({},i),{rider_share:f,restaurant_share:R,platform_earnings:g})}if((e==null?void 0:e.status)=="Delivered",(e==null?void 0:e.status)=="Rejected"||(e==null?void 0:e.status)=="Delivered"||(e==null?void 0:e.status)=="Cancelled"){let p=yield this.profileService.getProfile(),f=o(d({},p),{isOrderActive:!1})}return this.currentOrder.set(i),i}catch(i){throw console.log(i),i}})}updateCustomerWallet(e){return r(this,null,function*(){try{return{wallet:e==null?void 0:e.grandTotal,updated_at:new Date}}catch(t){throw console.log(t),t}})}assignRider(e){return r(this,null,function*(){try{let t=yield this.profileService.getProfile();if(t!=null&&t.isOrderActive){this.global.errorToast("Sorry! You have not completed the previous order, complete that to accept any more orders...");return}let a=o(d({},e),{rider_id:t.id,rider:t,status:"Ongoing"});return this.currentOrder.set(a),a}catch(t){throw console.log(t),t}})}getReviews(e){return r(this,null,function*(){try{yield this.api.delayedResponse(500),yield this.getUid();let t=c.filter(a=>(a==null?void 0:a.rider_id)==this.uid&&(a==null?void 0:a.status)=="Delivered"&&(a==null?void 0:a.rating));return e&&(t=t.slice(0,e),this._orderReviews.next(t)),t}catch(t){throw t}})}reset(){this._orders.next(null),this.uid=null}resetFilters(){this._ordersFiltered.next(null),this.uid=null}resetDashboard(){this.uid=null}resetCurrentOrder(){this.currentOrder.set(null)}};s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=_({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();export{Z as a};
