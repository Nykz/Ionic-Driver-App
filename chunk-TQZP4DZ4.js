import{a as G}from"./chunk-YN7NZTLL.js";import{a as W,e as j}from"./chunk-LG455DY4.js";import{a as Y}from"./chunk-KRQW3WRS.js";import{a as H}from"./chunk-AIDVXPZK.js";import{a as $}from"./chunk-WFCDVFAH.js";import"./chunk-3C7OKRBG.js";import"./chunk-7RJKU3Z7.js";import{a as A}from"./chunk-E7APRJJL.js";import{b as B}from"./chunk-RZ7UTHTO.js";import"./chunk-CFZVMA6D.js";import"./chunk-OBGSWFIL.js";import"./chunk-ZSWNRFCL.js";import{$b as R,C as S,Fb as I,H as O,J as s,Kb as D,Pb as L,R as a,S as l,T as u,Tb as P,Ub as T,X as y,Y as _,Yb as V,Z as h,Zb as F,ga as v,gc as x,hc as E,o as f,oc as N,p as b,qc as M,sc as k,x as g,y as m,ya as w,za as C}from"./chunk-HSJ3UP2Q.js";import"./chunk-5K2P5JXY.js";import"./chunk-G2NBWZGV.js";import"./chunk-5ZMMP3RU.js";import"./chunk-GBYUAKBO.js";import"./chunk-TFHXA6LG.js";import"./chunk-6L6JLL4O.js";import"./chunk-G3CV3VGG.js";import"./chunk-JX3TYZ34.js";import"./chunk-RUY5SX76.js";import"./chunk-NIOQNOHM.js";import"./chunk-4U6PRYVA.js";import"./chunk-4YKAI63M.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{f as c}from"./chunk-RW4GY4BD.js";function q(o,r){o&1&&u(0,"app-loading-order")}function z(o,r){if(o&1&&u(0,"app-empty-screen",10),o&2){let n=h();s("model",n.segmentValue=="1"?n.model:n.model1)}}function J(o,r){if(o&1){let n=y();a(0,"app-orders",12),_("status",function(i){f(n);let t=h(2);return b(t.changeStatus(i))})("call",function(i){f(n);let t=h(2);return b(t.call(i))})("assign",function(i){f(n);let t=h(2);return b(t.assignRider(i))}),l()}if(o&2){let n=r.$implicit;s("order",n)}}function K(o,r){if(o&1&&(a(0,"ion-list"),O(1,J,1,1,"app-orders",11),l()),o&2){let n=h();g(),s("ngForOf",n.newOrders)}}function Q(o,r){if(o&1&&u(0,"app-orders",14),o&2){let n=r.$implicit;s("order",n)}}function U(o,r){if(o&1&&(a(0,"ion-list"),O(1,Q,1,1,"app-orders",13),l()),o&2){let n=h();g(),s("ngForOf",n.ongoingOrders)}}var ce=(()=>{let r=class r{constructor(e,i,t,d){this.global=e,this.orderService=i,this.profileService=t,this.locationService=d,this.segmentValue="1",this.newOrders=[],this.ongoingOrders=[],this.isLoading=!1,this.model={icon:"fast-food-outline",title:"No New Orders"},this.model1={icon:"fast-food-outline",title:"No Ongoing Orders"},this.toggleFlag=!1,W({callOutline:j})}ngOnInit(){return c(this,null,function*(){yield this.profileService.getProfile(),this.global.customStatusbar(),this.profileSub=this.profileService.profile.subscribe({next:e=>{var i;console.log("profile: ",e),this.profile=e,((i=this.profile)==null?void 0:i.current_duty)=="inactive"&&!this.toggleFlag&&(console.log("clear watch"),this.toggleFlag=!0,this.locationService.clearLocationWatch())}}),this.getNewOrders(),this.newOrdersSub=this.orderService.newOrders.subscribe({next:e=>{this.newOrders=e}}),this.ongoingOrdersSub=this.orderService.ongoingOrders.subscribe({next:e=>{this.ongoingOrders=e}})})}refresh(e){setTimeout(()=>c(this,null,function*(){console.log(e),yield this.locationService.updateRiderLocation(),this.ngOnDestroy(),this.segmentValue="1",this.newOrders=[],this.ongoingOrders=[],yield this.profileService.getProfile(),this.getNewOrders(),e.target.complete()}),2e3)}segmentChanged(e){var i,t;console.log(e),this.segmentValue=e.detail.value,this.segmentValue=="1"&&((i=this.newOrders)==null?void 0:i.length)==0?this.getNewOrders():this.segmentValue=="2"&&((t=this.ongoingOrders)==null?void 0:t.length)==0&&this.getOngoingOrders()}getNewOrders(){return c(this,null,function*(){this.isLoading=!0;try{console.log("getorders"),yield this.orderService.getNewOrders(),this.isLoading=!1}catch(e){console.log(e),this.isLoading=!1,this.global.errorToast()}})}getOngoingOrders(){return c(this,null,function*(){this.isLoading=!0;try{console.log("getorders"),yield this.orderService.getOngoingOrders(),this.isLoading=!1}catch(e){console.log(e),this.isLoading=!1,this.global.errorToast()}})}changeStatus(e){return c(this,null,function*(){try{this.global.showLoader(),console.log(e);let i=yield this.orderService.changeOrderStatus(e);console.log("status change result: ",i),this.global.hideLoader()}catch(i){console.log(i),this.global.hideLoader(),this.global.errorToast()}})}changeDuty(e){return c(this,null,function*(){var i;try{if(console.log(this.toggleFlag),this.toggleFlag){console.log(e.detail.checked);let t=e.detail.checked,d="active";t?this.locationService.resumeWatch():(d="inactive",this.locationService.clearLocationWatch()),yield this.profileService.changeDutyStatus(d),this.global.showToast(t?"You are back online":"You are now offline","secondary","bottom")}else this.toggleFlag=!0,((i=this.profile)==null?void 0:i.current_duty)=="active"&&this.locationService.resumeWatch()}catch(t){console.log(t),this.global.errorToast()}})}assignRider(e){return c(this,null,function*(){try{this.global.showLoader(),console.log(e),yield this.orderService.assignRider(e),this.global.hideLoader(),this.global.navigate(["/","tabs","order-detail",e==null?void 0:e.id])}catch(i){console.log(i),this.global.hideLoader(),this.global.errorToast()}})}call(e){this.global.call(e).then(()=>{}).catch(i=>console.log(i))}ngOnDestroy(){console.log("ondestroy dashboardpage"),this.newOrdersSub&&this.newOrdersSub.unsubscribe(),this.ongoingOrdersSub&&this.ongoingOrdersSub.unsubscribe(),this.orderService.resetDashboard()}};r.\u0275fac=function(i){return new(i||r)(m(k),m(A),m(B),m(G))},r.\u0275cmp=S({type:r,selectors:[["app-dashboard"]],decls:22,vars:6,consts:[["slot","end"],["aria-label","duty","color","secondary",3,"ionChange","checked"],["align","center",3,"ionChange"],[3,"value"],["value","1"],["value","2"],[1,"ion-padding"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],[3,"model",4,"ngIf"],[3,"model"],[3,"order","status","call","assign",4,"ngFor","ngForOf"],[3,"status","call","assign","order"],[3,"order",4,"ngFor","ngForOf"],[3,"order"]],template:function(i,t){i&1&&(a(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),v(3,"DASHBOARD"),l(),a(4,"ion-buttons",0)(5,"ion-toggle",1),_("ionChange",function(p){return t.changeDuty(p)}),l()()(),a(6,"ion-toolbar")(7,"div",2),_("ionChange",function(p){return t.segmentChanged(p)}),a(8,"ion-segment",3)(9,"ion-segment-button",4)(10,"ion-label"),v(11,"NEW ORDERS"),l()(),a(12,"ion-segment-button",5)(13,"ion-label"),v(14,"ONGOING ORDERS"),l()()()()()(),a(15,"ion-content",6)(16,"ion-refresher",7),_("ionRefresh",function(p){return t.refresh(p)}),u(17,"ion-refresher-content"),l(),O(18,q,1,0,"app-loading-order",8)(19,z,1,1,"app-empty-screen",9)(20,K,2,1,"ion-list",8)(21,U,2,1,"ion-list",8),l()),i&2&&(g(5),s("checked",(t.profile==null?null:t.profile.current_duty)=="active"),g(3),s("value",t.segmentValue),g(10),s("ngIf",t.isLoading),g(),s("ngIf",!t.isLoading&&(t.segmentValue=="1"&&(t.newOrders==null?null:t.newOrders.length)==0||t.segmentValue=="2"&&(t.ongoingOrders==null?null:t.ongoingOrders.length)==0)),g(),s("ngIf",!t.isLoading&&t.segmentValue=="1"),g(),s("ngIf",!t.isLoading&&t.segmentValue=="2"))},dependencies:[V,F,L,E,N,R,P,D,T,x,I,M,w,C,H,Y,$],styles:["ion-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%}ion-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{--background: transparent}ion-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--color-checked: var(--ion-color-tertiary)}"]});let o=r;return o})();export{ce as DashboardPage};
