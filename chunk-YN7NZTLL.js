import{b}from"./chunk-RZ7UTHTO.js";import{a as w}from"./chunk-OBGSWFIL.js";import{j as m,l as s,u as y}from"./chunk-HSJ3UP2Q.js";import{b as c,c as u}from"./chunk-5ZMMP3RU.js";import{f as l}from"./chunk-RW4GY4BD.js";var i=u("Geolocation",{web:()=>import("./chunk-53U6SCQR.js").then(a=>new a.GeolocationWeb)});var p=function(a){return a.Accessibility="accessibility",a.Account="account",a.AirplaneMode="airplane_mode",a.Apn="apn",a.ApplicationDetails="application_details",a.ApplicationDevelopment="application_development",a.Application="application",a.AppNotification="app_notification",a.BatteryOptimization="battery_optimization",a.Bluetooth="bluetooth",a.Captioning="captioning",a.Cast="cast",a.DataRoaming="data_roaming",a.Date="date",a.Display="display",a.Dream="dream",a.Home="home",a.Keyboard="keyboard",a.KeyboardSubType="keyboard_subtype",a.Locale="locale",a.Location="location",a.ManageApplications="manage_applications",a.ManageAllApplications="manage_all_applications",a.MemoryCard="memory_card",a.Network="network",a.NfcSharing="nfcsharing",a.NfcPayment="nfc_payment",a.NfcSettings="nfc_settings",a.Print="print",a.Privacy="privacy",a.QuickLaunch="quick_launch",a.Search="search",a.Security="security",a.Settings="settings",a.ShowRegulatoryInfo="show_regulatory_info",a.Sound="sound",a.Storage="storage",a.Sync="sync",a.Usage="usage",a.UserDictionary="user_dictionary",a.VoiceInput="voice_input",a.Wifi="wifi",a.WifiIp="wifi_ip",a.Wireless="wireless",a}(p||{}),h=function(a){return a.About="about",a.App="app",a.AutoLock="autoLock",a.Bluetooth="bluetooth",a.DateTime="dateTime",a.FaceTime="facetime",a.General="general",a.Keyboard="keyboard",a.ICloud="iCloud",a.ICloudStorageBackup="iCloudStorageBackup",a.International="international",a.LocationServices="locationServices",a.Music="music",a.Notes="notes",a.Notifications="notifications",a.Phone="phone",a.Photos="photos",a.ManagedConfigurationList="managedConfigurationList",a.Reset="reset",a.Ringtone="ringtone",a.Sounds="sounds",a.SoftwareUpdate="softwareUpdate",a.Store="store",a.Tracking="tracking",a.Wallpaper="wallpaper",a.WiFi="wifi",a.Tethering="tethering",a.DoNotDisturb="doNotDisturb",a.TouchIdPasscode="touchIdPasscode",a.ScreenTime="screenTime",a.Accessibility="accessibility",a}(h||{});var P=u("NativeSettings",{web:()=>import("./chunk-TCPXJPW5.js").then(a=>new a.NativeSettingsWeb)});var q=(()=>{let r=class r{constructor(e,t,o){this.locationAccuracy=e,this.zone=t,this.profileService=o}getCurrentLocation(e){return l(this,null,function*(){try{if(!c.isPluginAvailable("Geolocation"))return null;if(c.getPlatform()!="web"){let o=yield i.checkPermissions();if(console.log("Permission status: ",o.location),(o==null?void 0:o.location)!="granted"&&(yield i.requestPermissions()).location!="granted")return e&&(yield this.openSettings(!0)),null;c.getPlatform()=="android"&&this.enableGps()}let t={maximumAge:3e3,timeout:1e4,enableHighAccuracy:!1};return yield i.getCurrentPosition(t)}catch(t){throw console.log("geoloc error: ",t.message),e&&(t==null?void 0:t.message)=="Location services are not enabled"&&(yield this.openSettings()),t}})}enableGps(){return l(this,null,function*(){(yield this.locationAccuracy.canRequest())&&(yield this.locationAccuracy.request(this.locationAccuracy.REQUEST_PRIORITY_HIGH_ACCURACY))})}openSettings(e=!1){return console.log("open settings..."),P.open({optionAndroid:e?p.ApplicationDetails:p.Location,optionIOS:e?h.App:h.LocationServices})}updateRiderLocation(){return l(this,null,function*(){try{if(c.getPlatform()=="web")return;let e=yield this.getCurrentLocation(!0);if(e){let{latitude:t,longitude:o}=e.coords;yield this.profileService.updateLocation(t,o)}}catch(e){console.log("updateRiderLocation error: ",e)}})}watchPosition(e){return l(this,null,function*(){try{if(!c.isPluginAvailable("Geolocation"))return;if(c.getPlatform()!="web"){let o=yield i.checkPermissions();if(console.log("Permission status: ",o==null?void 0:o.location),(o==null?void 0:o.location)!="granted"){let n=yield i.requestPermissions();if(console.log("requestStatus: ",n),(n==null?void 0:n.location)!="granted"){e&&(yield this.openSettings(!0));return}}c.getPlatform()=="android"&&this.enableGps()}let t={maximumAge:3e3,timeout:1e4,enableHighAccuracy:!1};this.watchID=yield i.watchPosition(t,(o,n)=>{console.log("Watch",o),this.zone.run(()=>{if(o){let f={latitude:o.coords.latitude,longitude:o.coords.longitude};console.log(f),this.profileService.updateLocation(f.latitude,f.longitude)}})})}catch(t){throw console.log("location error",t),t}})}resumeWatch(){return l(this,null,function*(){try{console.log("watchid: ",this.watchID),this.watchID||(yield this.watchPosition(!0))}catch(e){console.log("resumewatch: ",e)}})}clearLocationWatch(){return l(this,null,function*(){this.watchID!=null&&(yield i.clearWatch({id:this.watchID}),this.watchID=null)})}};r.\u0275fac=function(t){return new(t||r)(s(w),s(y),s(b))},r.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();export{q as a};
